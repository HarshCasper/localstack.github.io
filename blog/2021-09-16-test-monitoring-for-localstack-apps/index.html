<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=stylesheet href=https://localstack.cloud/css/vendor/custom.css><link rel=preload as=font href=https://localstack.cloud/fonts/vendor/jost/jost-v4-latin-regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://localstack.cloud/fonts/vendor/jost/jost-v4-latin-700.woff2 type=font/woff2 crossorigin><link rel=stylesheet href=https://localstack.cloud/main.2c179d973e5eae0d7939811c41ff490943268cd8575a40874a9d84e9505a644ca8624c0253f7ef4861c672ca62fa079f71aa781c120db8f6a8eebd5411c66d74.css integrity="sha512-LBedlz5erg15OYEcQf9JCUMmjNhXWkCHSp2E6VBaZEyoYkwCU/fvSGHGcspi+gefcap4HBINuPao7r1UEcZtdA==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>Test Monitoring for LocalStack Apps - LocalStack</title><meta name=description content="Developing Serverless Applications Locally with LocalStack and Debugging Tests with Thundra Foresight."><link rel=canonical href=https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image1.png"><meta name=twitter:title content="Test Monitoring for LocalStack Apps"><meta name=twitter:description content="Developing Serverless Applications Locally with LocalStack and Debugging Tests with Thundra Foresight."><meta name=twitter:site content="@_localstack"><meta name=twitter:creator content="@_localstack"><meta property="og:title" content="Test Monitoring for LocalStack Apps"><meta property="og:description" content="Developing Serverless Applications Locally with LocalStack and Debugging Tests with Thundra Foresight."><meta property="og:type" content="article"><meta property="og:url" content="/blog/2021-09-16-test-monitoring-for-localstack-apps/"><meta property="og:image" content="https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image1.png"><meta property="og:image" content="https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image2.png"><meta property="og:image" content="https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image3.png"><meta property="og:image" content="https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image4.png"><meta property="og:image" content="https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image5.png"><meta property="og:image" content="https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image6.png"><meta property="article:published_time" content="2021-09-16T13:10:00+02:00"><meta property="article:modified_time" content="2021-09-16T13:10:00+02:00"><meta property="og:site_name" content="LocalStack"><meta property="article:publisher" content="https://www.facebook.com/"><meta property="article:author" content="https://www.facebook.com/"><meta property="og:locale" content="en_US"><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"\/blog\/2021-09-16-test-monitoring-for-localstack-apps\/"},"headline":"Test Monitoring for LocalStack Apps","image":["/blog/2021-09-16-test-monitoring-for-localstack-apps/image1.png","/blog/2021-09-16-test-monitoring-for-localstack-apps/image2.png","/blog/2021-09-16-test-monitoring-for-localstack-apps/image3.png","/blog/2021-09-16-test-monitoring-for-localstack-apps/image4.png","/blog/2021-09-16-test-monitoring-for-localstack-apps/image5.png","/blog/2021-09-16-test-monitoring-for-localstack-apps/image6.png","/blog/2021-09-16-test-monitoring-for-localstack-apps/image7.png","/blog/2021-09-16-test-monitoring-for-localstack-apps/image8.png","/blog/2021-09-16-test-monitoring-for-localstack-apps/image9.png"],"datePublished":"2021-09-16T13:10:00CET","dateModified":"2021-09-16T13:10:00CET","author":{"@type":"Organization","name":"LocalStack"},"publisher":{"@type":"Organization","name":"LocalStack","logo":{"@type":"ImageObject","url":"\/\/images\/localstack.png"}},"description":"Developing Serverless Applications Locally with LocalStack and Debugging Tests with Thundra Foresight."}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https:\/\/localstack.cloud\/"},{"@type":"ListItem","position":3,"name":"Blog","item":"https:\/\/localstack.cloud\/\/blog\/"},{"@type":"ListItem","position":4,"name":"2021 09 16 Test Monitoring for Localstack Apps","item":"https:\/\/localstack.cloud\/\/blog\/2021-09-16-test-monitoring-for-localstack-apps\/"}]}</script><meta name=theme-color content="#fff"><link rel=apple-touch-icon sizes=180x180 href=https://localstack.cloud/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://localstack.cloud/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://localstack.cloud/favicon-16x16.png><link rel=manifest href=https://localstack.cloud/site.webmanifest><script>(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-101988473-1','auto'),ga('send','pageview')</script></head><body class="blog single"><div class="header-bar fixed-top"></div><header class="navbar fixed-top navbar-expand-md navbar-light"><div class=container><input class="menu-btn order-0" type=checkbox id=menu-btn>
<label class="menu-icon d-md-none" for=menu-btn><span class=navicon></span></label><a class="navbar-brand order-1 order-md-0 me-auto" href=https://localstack.cloud/><img src=https://localstack.cloud/images/localstack.png height=25px alt=Logo>
LocalStack</a><ul class="navbar-nav social-nav order-3 order-md-5"><li class=nav-item><a class=nav-link target=_blank href=https://twitter.com/_localstack><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg><span class="ms-2 visually-hidden">Twitter</span></a></li><li class=nav-item><a class=nav-link target=_blank href=https://github.com/localstack><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg><span class="ms-2 visually-hidden">GitHub</span></a></li><li class=nav-item><a class="btn btn-primary" type=link href=https://app.localstack.cloud><i class="bi bi-laptop"></i> Sign up</a></li></ul><div class="collapse navbar-collapse order-4 order-md-1"><ul class="navbar-nav main-nav me-auto order-5 order-md-2"><li class=nav-item><a class=nav-link style=white-space:nowrap href=https://localstack.cloud/features/>Features</a></li><li class=nav-item><a class=nav-link style=white-space:nowrap href=https://localstack.cloud/pricing/>Pricing</a></li><li class=nav-item><a class=nav-link style=white-space:nowrap href=https://localstack.cloud/docs/getting-started/overview/>Docs</a></li><li class="nav-item active"><a class=nav-link style=white-space:nowrap href=https://localstack.cloud/blog/>Blog</a></li><li class=nav-item><a class=nav-link style=white-space:nowrap href=https://app.localstack.cloud><i class="bi bi-laptop"></i> App</a></li></ul><div class="break order-6 d-md-none"></div></div></div></header><div class="wrap container" role=document><div class=content><div class="row justify-content-center"><div class="col-md-12 col-lg-10 col-xl-8"><article><div class=blog-header><h1>Test Monitoring for LocalStack Apps</h1><p><small>Posted September 16, 2021 by <a class="stretched-link position-relative" href=https://localstack.cloud/contributors/oguzhan-ozdemir-solutions-engineer-thundra/>Oguzhan Ozdemir, Solutions Engineer @ Thundra</a>&nbsp;&dash;&nbsp;<strong>9&nbsp;min read</strong></small><p></div><p class=lead>Developing Serverless Applications Locally with LocalStack and Debugging Tests with Thundra Foresight. (Guest blog post by Oguzhan Ozdemir, Solutions Engineer @ Thundra)</p><div class="mt-4 mb-4 text-center"><i class="bi bi-stack"></i></div><p>LocalStack gives developers the freedom to develop their cloud applications locally (even offline) - enabling a highly efficient dev&test loop. It also helps prevent scary cloud bills at the end of every month! LocalStack has an amazing community of users, contributors, and supporters - and generally demonstrates a very strong commitment to supporting open source.</p><p>The community uses LocalStack for many use cases such as developing microservice cloud applications. One of the strongest use cases why developers use LocalStack is “testing”. Since the local testing framework is provided, the need for setting up multiple testing environments on the cloud disappears and distributed microservice applications can easily be developed, tested, and deployed with green tests.</p><p>But, wait! Not everything will go so smoothly all the time. Oh, I wish we were in such a fairy tale where the horses were unicorns with wings, and tests passed in the first run.</p><p>It’s a fact that tests fail. All the time! Some erroneous tests make developers tear their hair out while trying to find the root cause in the log piles. And sometimes it is not a road blocker but it is definitely a fly in the ointment.</p><p>Today, it’s such a pain relief to use LocalStack while developing test environments. It saves us from setting up complex cloud environments with its easy-to-use mocked cloud services. On the other hand, there is still a need for debugging failed tests without getting lost within the logs of our complex architectures.</p><p>This is when Thundra comes to the rescue with Foresight for those who use LocalStack on their local development machine or in their Continuous Integration (CI) pipeline. Foresight helps developers understand the root causes of failing & long-running tests easily and quickly. It gives rich insights about the passed, failed, aborted tests of the test runs of the test suites.</p><h4 id=sample-application>Sample application</h4><p>Let’s talk about how we can get the best out of these two products. For this purpose, we’ve developed a small application. An application that’ll spawn multiple AWS services on your local machine with LocalStack and monitor your distributed architecture and its tests with Thundra Foresight.</p><a href=https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image8.png target=_blank><figure><img class="img-fluid lazyload blur-up" data-sizes=auto src=https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image8_hud935164d597eecb87042439b0337f7ca_186928_20x0_resize_box_2.png data-srcset="https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image8_hud935164d597eecb87042439b0337f7ca_186928_900x0_resize_box_2.png 900w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image8_hud935164d597eecb87042439b0337f7ca_186928_800x0_resize_box_2.png 800w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image8_hud935164d597eecb87042439b0337f7ca_186928_700x0_resize_box_2.png 700w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image8_hud935164d597eecb87042439b0337f7ca_186928_600x0_resize_box_2.png 600w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image8_hud935164d597eecb87042439b0337f7ca_186928_500x0_resize_box_2.png 500w" width=1999 height=1057><noscript><img class=img-fluid sizes=100vw srcset="https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image8_hud935164d597eecb87042439b0337f7ca_186928_900x0_resize_box_2.png 900w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image8_hud935164d597eecb87042439b0337f7ca_186928_800x0_resize_box_2.png 800w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image8_hud935164d597eecb87042439b0337f7ca_186928_700x0_resize_box_2.png 700w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image8_hud935164d597eecb87042439b0337f7ca_186928_600x0_resize_box_2.png 600w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image8_hud935164d597eecb87042439b0337f7ca_186928_500x0_resize_box_2.png 500w" src=https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image8.png width=1999 height=1057></noscript></figure></a><p>What we’ve planned here is somewhat simple. An AWS Lambda function, let’s call this Lambda #1, with an HTTP endpoint to take a request then writes to an SQS queue for further processing and then writes the same request into a DynamoDB database for bookkeeping purposes. Then, that SQS queue will pass the incoming message to our processor Lambda, our Lamda #2.</p><p>Once the processing is successful, Lambda #2 will notify an SNS topic, which triggers our archive Lambda, Lambda #3. When Lambda #3 is triggered, it’ll go back to the DynamoDB and update the request’s record, and set its state. It’ll also write the result of this whole request into a file and put it in an S3 bucket.</p><p>This might seem a lot, but all it does is pass the body of an HTTP request between different services and manipulate it along the way. This project is developed by Thundra’s Software Engineer <a href=https://twitter.com/tolgatakir>Tolga Takır</a> and the source code is available in <a href=https://github.com/thundra-io/thundra-demo-localstack-java>our GitHub repository</a>. In there, you’ll find the documentation on how to run this project on your machine.</p><p>After having all the requirements set up on our computer, we can simply run <code>make start</code> to spin up our application with LocalStack. This will take a couple of minutes, but once it’s completed, we’ll have our API running inside the LocalStack container.</p><p>At this point, we can run the following command to see if our API is up and running.</p><pre><code class=language-bash>$ awslocal apigateway get-rest-apis
{
    &quot;items&quot;: [
        {
            &quot;id&quot;: &quot;&lt;YOUR_APIGATEWAY_ID&gt;&quot;,
            &quot;name&quot;: &quot;local-thundra-demo-localstack&quot;,
            &quot;createdDate&quot;: &quot;2021-09-06T13:54:57+03:00&quot;,
            &quot;version&quot;: &quot;V1&quot;,
            &quot;binaryMediaTypes&quot;: [],
            &quot;apiKeySource&quot;: &quot;HEADER&quot;,
            &quot;endpointConfiguration&quot;: {
                &quot;types&quot;: [
                    &quot;EDGE&quot;
                ]
            },
            &quot;tags&quot;: {},
            &quot;disableExecuteApiEndpoint&quot;: false
        }
    ]
}
</code></pre><p>If this result comes up empty, you might be looking in the wrong region.</p><p>We&rsquo;ve confirmed that our API is up and running. You can also send a GET request to Lambda&rsquo;s endpoint. This might take some time since it’s a cold start, but eventually, it should return an empty list.</p><pre><code class=language-bash>$ curl http://&lt;YOUR_APIGATEWAY_ID&gt;.execute-api.localhost.localstack.cloud:4566/local/requests

[]%
</code></pre><p>Let’s see what Thundra Foresight can do now. We can kill the current LocalStack container, we won’t be needing it for running the tests.</p><h4 id=how-to-integrate-foresight-into-localstack>How to integrate Foresight into LocalStack</h4><p>Thundra Java Agent comes built-in with LocalStack v0.12.16 and later. If you have the latest version of LocalStack, all you need to do is set <code>THUNDRA_APIKEY</code> as an environment variable and you are good to go with application monitoring. To enable Foresight as well, <code>THUNDRA_AGENT_TEST_PROJECT_ID</code> environment variable must be set.</p><p>You can get your API Key and Project ID at https://foresight.thundra.io.</p><p>For this project, you can set them in the <code>Makefile</code>. If that’s done, let’s run the tests with <code>make test</code>. After some time, if the demo gods are with us and we don’t have any problem, we should be able to see the results.</p><pre><code>[INFO]
[INFO] Results:
[INFO]
[ERROR] Failures:
[ERROR]   AppRequestLocalStackTest.testCreateNewRequest:30-&gt;LocalStackTest.assertEventually:90-&gt;lambda$testCreateNewRequest$0:38 [Extracted: requestId, status]
Expecting ArrayList:
  [(&quot;ae1bd554&quot;, &quot;PROCESSING&quot;), (&quot;ae1bd554&quot;, &quot;QUEUED&quot;)]
to contain:
  [(&quot;ae1bd554&quot;, &quot;QUEUED&quot;), (&quot;ae1bd554&quot;, &quot;PROCESSING&quot;), (&quot;ae1bd554&quot;, &quot;FINISHED&quot;)]
but could not find the following element(s):
  [(&quot;ae1bd554&quot;, &quot;FINISHED&quot;)]
[INFO]
[ERROR] Tests run: 1, Failures: 1, Errors: 0, Skipped: 0
[INFO]
[INFO] ------------------------------------------------------------------------
[INFO] BUILD FAILURE
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  02:00 min
[INFO] Finished at: 2021-09-06T21:21:01+03:00
[INFO] ------------------------------------------------------------------------
</code></pre><p>Looks like our test has failed. By looking at the logs, I can tell that we didn’t get the <code>FINISHED</code> state in our collection. Let’s check Foresight and then click to our test to see if we can see what went wrong.</p><a href=https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image3.png target=_blank><figure><img class="img-fluid lazyload blur-up" data-sizes=auto src=https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image3_hu288b3fe3abc9de69c03a13949354cba3_107408_20x0_resize_box_2.png data-srcset="https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image3_hu288b3fe3abc9de69c03a13949354cba3_107408_900x0_resize_box_2.png 900w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image3_hu288b3fe3abc9de69c03a13949354cba3_107408_800x0_resize_box_2.png 800w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image3_hu288b3fe3abc9de69c03a13949354cba3_107408_700x0_resize_box_2.png 700w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image3_hu288b3fe3abc9de69c03a13949354cba3_107408_600x0_resize_box_2.png 600w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image3_hu288b3fe3abc9de69c03a13949354cba3_107408_500x0_resize_box_2.png 500w" width=1469 height=966><noscript><img class=img-fluid sizes=100vw srcset="https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image3_hu288b3fe3abc9de69c03a13949354cba3_107408_900x0_resize_box_2.png 900w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image3_hu288b3fe3abc9de69c03a13949354cba3_107408_800x0_resize_box_2.png 800w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image3_hu288b3fe3abc9de69c03a13949354cba3_107408_700x0_resize_box_2.png 700w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image3_hu288b3fe3abc9de69c03a13949354cba3_107408_600x0_resize_box_2.png 600w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image3_hu288b3fe3abc9de69c03a13949354cba3_107408_500x0_resize_box_2.png 500w" src=https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image3.png width=1469 height=966></noscript></figure></a><p>When you are on the test detail page, you can click the <code>Trace Map</code> button on the top right, it’ll open a window and will automatically redirect you to your invocations trace map. Here, we can see the whole flow, identical to what we’ve designed at the beginning of this post. We will also be able to tell where the error comes from.</p><a href=https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image9.png target=_blank><figure><img class="img-fluid lazyload blur-up" data-sizes=auto src=https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image9_hua609710ae074df46d8e6dede42fdb854_154829_20x0_resize_box_2.png data-srcset="https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image9_hua609710ae074df46d8e6dede42fdb854_154829_900x0_resize_box_2.png 900w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image9_hua609710ae074df46d8e6dede42fdb854_154829_800x0_resize_box_2.png 800w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image9_hua609710ae074df46d8e6dede42fdb854_154829_700x0_resize_box_2.png 700w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image9_hua609710ae074df46d8e6dede42fdb854_154829_600x0_resize_box_2.png 600w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image9_hua609710ae074df46d8e6dede42fdb854_154829_500x0_resize_box_2.png 500w" width=1000 height=1000><noscript><img class=img-fluid sizes=100vw srcset="https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image9_hua609710ae074df46d8e6dede42fdb854_154829_900x0_resize_box_2.png 900w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image9_hua609710ae074df46d8e6dede42fdb854_154829_800x0_resize_box_2.png 800w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image9_hua609710ae074df46d8e6dede42fdb854_154829_700x0_resize_box_2.png 700w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image9_hua609710ae074df46d8e6dede42fdb854_154829_600x0_resize_box_2.png 600w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image9_hua609710ae074df46d8e6dede42fdb854_154829_500x0_resize_box_2.png 500w" src=https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image9.png width=1000 height=1000></noscript></figure></a><p>The red arrow that goes from our Lambda #3 to DynamoDB means there is a problem there. If we click on that, we’ll see a trace chart and summary of this request.</p><a href=https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image1.png target=_blank><figure><img class="img-fluid lazyload blur-up" data-sizes=auto src=https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image1_hu7f1c76287f74c08439e66c0833848c85_236329_20x0_resize_box_2.png data-srcset="https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image1_hu7f1c76287f74c08439e66c0833848c85_236329_900x0_resize_box_2.png 900w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image1_hu7f1c76287f74c08439e66c0833848c85_236329_800x0_resize_box_2.png 800w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image1_hu7f1c76287f74c08439e66c0833848c85_236329_700x0_resize_box_2.png 700w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image1_hu7f1c76287f74c08439e66c0833848c85_236329_600x0_resize_box_2.png 600w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image1_hu7f1c76287f74c08439e66c0833848c85_236329_500x0_resize_box_2.png 500w" width=1680 height=1604><noscript><img class=img-fluid sizes=100vw srcset="https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image1_hu7f1c76287f74c08439e66c0833848c85_236329_900x0_resize_box_2.png 900w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image1_hu7f1c76287f74c08439e66c0833848c85_236329_800x0_resize_box_2.png 800w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image1_hu7f1c76287f74c08439e66c0833848c85_236329_700x0_resize_box_2.png 700w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image1_hu7f1c76287f74c08439e66c0833848c85_236329_600x0_resize_box_2.png 600w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image1_hu7f1c76287f74c08439e66c0833848c85_236329_500x0_resize_box_2.png 500w" src=https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image1.png width=1680 height=1604></noscript></figure></a><p>Hmm&mldr; An <code>AmazonDynamoDBException</code> and a message that says everything fails. Let’s click on that up-arrow and see what’s the source of this.</p><a href=https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image4.png target=_blank><figure><img class="img-fluid lazyload blur-up" data-sizes=auto src=https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image4_hub3877a71fe9069107deeed30c1058fb3_55605_20x0_resize_box_2.png data-srcset="https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image4_hub3877a71fe9069107deeed30c1058fb3_55605_900x0_resize_box_2.png 900w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image4_hub3877a71fe9069107deeed30c1058fb3_55605_800x0_resize_box_2.png 800w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image4_hub3877a71fe9069107deeed30c1058fb3_55605_700x0_resize_box_2.png 700w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image4_hub3877a71fe9069107deeed30c1058fb3_55605_600x0_resize_box_2.png 600w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image4_hub3877a71fe9069107deeed30c1058fb3_55605_500x0_resize_box_2.png 500w" width=898 height=428><noscript><img class=img-fluid sizes=100vw srcset="https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image4_hub3877a71fe9069107deeed30c1058fb3_55605_900x0_resize_box_2.png 900w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image4_hub3877a71fe9069107deeed30c1058fb3_55605_800x0_resize_box_2.png 800w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image4_hub3877a71fe9069107deeed30c1058fb3_55605_700x0_resize_box_2.png 700w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image4_hub3877a71fe9069107deeed30c1058fb3_55605_600x0_resize_box_2.png 600w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image4_hub3877a71fe9069107deeed30c1058fb3_55605_500x0_resize_box_2.png 500w" src=https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image4.png width=898 height=428></noscript></figure></a><p>It looks like our <code>addRequest</code> method has failed when saving the item into our DynamoDB database. Let’s see our trace map again. If we click the JUnit 5 node on our map, we’ll see the whole trace chart for our test.</p><a href=https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image2.png target=_blank><figure><img class="img-fluid lazyload blur-up" data-sizes=auto src=https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image2_hu9a68d272dc7d644c73bab2f57d2de3fd_274514_20x0_resize_box_2.png data-srcset="https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image2_hu9a68d272dc7d644c73bab2f57d2de3fd_274514_900x0_resize_box_2.png 900w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image2_hu9a68d272dc7d644c73bab2f57d2de3fd_274514_800x0_resize_box_2.png 800w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image2_hu9a68d272dc7d644c73bab2f57d2de3fd_274514_700x0_resize_box_2.png 700w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image2_hu9a68d272dc7d644c73bab2f57d2de3fd_274514_600x0_resize_box_2.png 600w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image2_hu9a68d272dc7d644c73bab2f57d2de3fd_274514_500x0_resize_box_2.png 500w" width=1999 height=1010><noscript><img class=img-fluid sizes=100vw srcset="https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image2_hu9a68d272dc7d644c73bab2f57d2de3fd_274514_900x0_resize_box_2.png 900w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image2_hu9a68d272dc7d644c73bab2f57d2de3fd_274514_800x0_resize_box_2.png 800w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image2_hu9a68d272dc7d644c73bab2f57d2de3fd_274514_700x0_resize_box_2.png 700w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image2_hu9a68d272dc7d644c73bab2f57d2de3fd_274514_600x0_resize_box_2.png 600w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image2_hu9a68d272dc7d644c73bab2f57d2de3fd_274514_500x0_resize_box_2.png 500w" src=https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image2.png width=1999 height=1010></noscript></figure></a><p>On the right hand side of the screen, we see the original assertion error and it’s method marked as red on the trace chart. Let’s click to that second red row.</p><a href=https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image7.png target=_blank><figure><img class="img-fluid lazyload blur-up" data-sizes=auto src=https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image7_hue4c3b5114aed8172e9953cee5adf172c_327947_20x0_resize_box_2.png data-srcset="https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image7_hue4c3b5114aed8172e9953cee5adf172c_327947_900x0_resize_box_2.png 900w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image7_hue4c3b5114aed8172e9953cee5adf172c_327947_800x0_resize_box_2.png 800w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image7_hue4c3b5114aed8172e9953cee5adf172c_327947_700x0_resize_box_2.png 700w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image7_hue4c3b5114aed8172e9953cee5adf172c_327947_600x0_resize_box_2.png 600w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image7_hue4c3b5114aed8172e9953cee5adf172c_327947_500x0_resize_box_2.png 500w" width=1999 height=970><noscript><img class=img-fluid sizes=100vw srcset="https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image7_hue4c3b5114aed8172e9953cee5adf172c_327947_900x0_resize_box_2.png 900w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image7_hue4c3b5114aed8172e9953cee5adf172c_327947_800x0_resize_box_2.png 800w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image7_hue4c3b5114aed8172e9953cee5adf172c_327947_700x0_resize_box_2.png 700w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image7_hue4c3b5114aed8172e9953cee5adf172c_327947_600x0_resize_box_2.png 600w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image7_hue4c3b5114aed8172e9953cee5adf172c_327947_500x0_resize_box_2.png 500w" src=https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image7.png width=1999 height=970></noscript></figure></a><p>This opened our debugging window again. Now, let’s zoom in on that and play the execution until the end.</p><a href=https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image5.png target=_blank><figure><img class="img-fluid lazyload blur-up" data-sizes=auto src=https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image5_hu1eef8db3291370ef2a35af7cdddca487_241137_20x0_resize_box_2.png data-srcset="https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image5_hu1eef8db3291370ef2a35af7cdddca487_241137_900x0_resize_box_2.png 900w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image5_hu1eef8db3291370ef2a35af7cdddca487_241137_800x0_resize_box_2.png 800w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image5_hu1eef8db3291370ef2a35af7cdddca487_241137_700x0_resize_box_2.png 700w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image5_hu1eef8db3291370ef2a35af7cdddca487_241137_600x0_resize_box_2.png 600w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image5_hu1eef8db3291370ef2a35af7cdddca487_241137_500x0_resize_box_2.png 500w" width=1054 height=634><noscript><img class=img-fluid sizes=100vw srcset="https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image5_hu1eef8db3291370ef2a35af7cdddca487_241137_900x0_resize_box_2.png 900w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image5_hu1eef8db3291370ef2a35af7cdddca487_241137_800x0_resize_box_2.png 800w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image5_hu1eef8db3291370ef2a35af7cdddca487_241137_700x0_resize_box_2.png 700w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image5_hu1eef8db3291370ef2a35af7cdddca487_241137_600x0_resize_box_2.png 600w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image5_hu1eef8db3291370ef2a35af7cdddca487_241137_500x0_resize_box_2.png 500w" src=https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image5.png width=1054 height=634></noscript></figure></a><p>We can see that our <code>getResponse</code> list doesn’t have the <code>FINISHED</code> state as expected.</p><p>Now, we have some idea where our error originated and what variables were present at the time of the execution of our test. We call this <a href=https://foresight.docs.thundra.io/core-concepts/enabling-time-travel-debugging>Time Travel Debugging</a>. With this instrumentation method, Thundra Agent will give you the ability to save your traces and play them line by line to debug your application and your tests.</p><p>Now, let’s see how we can fix this. But, as you might have guessed, there isn’t any bug in the code and the error is made up.</p><p><em>Or is it?</em></p><h4 id=chaos-is-the-answer>Chaos is the Answer</h4><p>Well, usually developers write tests to ensure their application doesn’t break when they develop new features, fix bugs, or change anything in their codebase. Generally, this will give you a good estimate of how robust your application is. But not all errors come from our inability to write bug-free code.</p><p>Let’s face it. Some of the things we do feel like magic. There are a lot of things that can go wrong between your local environment and your production that we don’t understand at first sight. Even when you successfully push your code to production, things can still fail your efforts. A network partition, latency in the network where your code runs, or some disk failures&mldr; All of these could cost you a lot and this isn’t a perfect world. Some of these have already happened to you or might happen in the future. The best you can do is to be prepared for all of these as much as possible.</p><p>Purposefully injecting a bug, an exception, or latency might seem counterintuitive, but it’s better than the unexpected. This practice of doing a controlled experiment on your distributed system is called <a href=https://apm.docs.thundra.io/monitoring/chaos-engineering-with-thundra>Chaos Engineering</a>. At Thundra, we value the chaos, do our best to be prepared for the unexpected and we want our customers to be the same, if not more. By using Thundra Agent in your project, you’ll have the capability to engineer your own chaos experiment for your applications and your tests.</p><p>So, that’s what we did here. If you go to the following file, you’ll see that we’ve implemented a class for chaos injection and injected an error to our Lambda #3.</p><a href=https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image6.png target=_blank><figure><img class="img-fluid lazyload blur-up" data-sizes=auto src=https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image6_hu9b63f7e2dbfa62d09587a0c1e3e9ac13_50205_20x0_resize_box_2.png data-srcset="https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image6_hu9b63f7e2dbfa62d09587a0c1e3e9ac13_50205_900x0_resize_box_2.png 900w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image6_hu9b63f7e2dbfa62d09587a0c1e3e9ac13_50205_800x0_resize_box_2.png 800w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image6_hu9b63f7e2dbfa62d09587a0c1e3e9ac13_50205_700x0_resize_box_2.png 700w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image6_hu9b63f7e2dbfa62d09587a0c1e3e9ac13_50205_600x0_resize_box_2.png 600w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image6_hu9b63f7e2dbfa62d09587a0c1e3e9ac13_50205_500x0_resize_box_2.png 500w" width=916 height=211><noscript><img class=img-fluid sizes=100vw srcset="https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image6_hu9b63f7e2dbfa62d09587a0c1e3e9ac13_50205_900x0_resize_box_2.png 900w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image6_hu9b63f7e2dbfa62d09587a0c1e3e9ac13_50205_800x0_resize_box_2.png 800w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image6_hu9b63f7e2dbfa62d09587a0c1e3e9ac13_50205_700x0_resize_box_2.png 700w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image6_hu9b63f7e2dbfa62d09587a0c1e3e9ac13_50205_600x0_resize_box_2.png 600w,https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image6_hu9b63f7e2dbfa62d09587a0c1e3e9ac13_50205_500x0_resize_box_2.png 500w" src=https://localstack.cloud/blog/2021-09-16-test-monitoring-for-localstack-apps/image6.png width=916 height=211></noscript></figure></a><p>To fix the error, we can simply comment out these lines. Let’s run the tests again and see our tests become successful.</p><pre><code class=language-bash>[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 102.819 s - in io.thundra.demo.localstack.integration.AppRequestLocalStackTest
[INFO]
[INFO] Results:
[INFO]
[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0
[INFO]
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  02:04 min
[INFO] Finished at: 2021-09-07T18:01:22+03:00
[INFO] ------------------------------------------------------------------------
</code></pre><p>In addition to application-level chaos engineering with Thundra, we can also inject errors at the infrastructure level with LocalStack - for example, injecting Kinesis stream errors by configuring <code>KINESIS_ERROR_PROBABILITY=0.8</code>. But let’s not go into too much detail here - we’ll cover that in a separate blog post!</p><h4 id=optimizations-and-thundra-lambda-server>Optimizations and Thundra Lambda Server</h4><p>When dealing with Lambdas, cold starts and feedback loops are always an issue whether you are on cloud or on your local. Thundra Agent comes with a lot of powerful utilities to minimize this tiresome cycle and helps you develop and debug your code faster and easier.</p><p>When you check the codes for this project, especially the <code>LocalStackTest.java</code> file, you’d see that we’re calling <code>make start-embedded</code> before each test. We’re simply forwarding all the Lambda invocations to the built-in Lambda server inside Thundra Agent. With this configuration, your cold starts and deployment time decreases substantially.</p><p>This will also affect the overall test time. A simple comparison is shown below.</p><pre><code class=language-bash>Test Execution Time (min) -------------
start                              2.53
start-embedded                     1.44
---------------------------------------
</code></pre><p>We hope to cover this feature in more detail in the future.</p><h4 id=summary-and-next-steps>Summary and Next Steps</h4><p>Summing up; LocalStack users can now have a granular view of their tests by plugging in Thundra Foresight with the demonstrated easy steps.</p><p>Foresight brings the power of observability that we have for production workloads into the tests for LocalStack users. If you want to learn more about how the integration works, you can check the documentation here.</p><p><strong>You can <a href="https://start.thundra.io/signup?utm_source=LocalStack&utm_medium=GuestBlog">signup for Thundra</a> and integrate your open source project for &ldquo;free forever and with full functionality&rdquo;</strong>.</p></article></div></div></div></div><section class="section section-md text-center mt-0 pt-0"><i class="bi bi-stack"></i></section><footer class="footer text-muted"><div class=footer-main><div class=container><div class=row><div class="col-12 col-sm-12 col-md-4 col-lg-3"><div><img class=footer-logo src=https://localstack.cloud/images/localstack.png></div></div><div class="col-12 col-sm-12 col-md-6 col-lg-9 mt-4 mt-md-0"><div class=row><div class=col><h5 class="mt-0 h6">LocalStack <i class="bi bi-stack"></i></h5><ul class=list-unstyled><li><a href=https://localstack.cloud/contact>Contact</a></li><li><a href=https://localstack.cloud/pricing>Pricing</a></li><li><a href=https://localstack.cloud/blog>Blog</a></li><li><a href=https://localstack.cloud/jobs>Jobs</a></li><li><a href=https://app.localstack.cloud>App</a></li></ul></div><div class=col><h5 class="mt-0 h6">Resources</h5><ul class=list-unstyled><li><a href=https://github.com/localstack>GitHub</a></li><li><a href=https://hub.docker.com/u/localstack>DockerHub</a></li><li><a href=https://localstack.cloud/docs>Docs</a></li></ul></div></div></div></div></div></div><div class=footer-bottom><div class=container><hr><div class=row><div class=col>Copyright &copy; LocalStack</div><div class="col text-end"><ul class=list-inline><li class=list-inline-item><a href=https://localstack.cloud/privacy-policy>Privacy policy</a></li><li class=list-inline-item><a href=https://localstack.cloud/terms>Terms of Service</a></li><li class=list-inline-item><a href=https://localstack.cloud/#>Imprint</a></li></ul></div></div></div></div></footer><script src=https://localstack.cloud/js/bootstrap.min.854c80fd4654f8399c2fe4a64bfd4f7bc817afa8ec0104a81c4889557b05426e20f3e7200b6265345fb47c379332d831ab8ed52ce3c1875d45263da2e1fbbff0.js integrity="sha512-hUyA/UZU+DmcL+SmS/1Pe8gXr6jsAQSoHEiJVXsFQm4g8+cgC2JlNF+0fDeTMtgxq47VLOPBh11FJj2i4fu/8A==" crossorigin=anonymous defer></script><script src=https://localstack.cloud/js/highlight.min.8cdbefd08ec63ef25f4b2510ae50c13b3d9ed43e25a15ddb55f14c33130e68cf8be3131ccf2d087c49f5f21fe88c2f0e2715a21f936047d0d0b85dc48cb864b9.js integrity="sha512-jNvv0I7GPvJfSyUQrlDBOz2e1D4loV3bVfFMMxMOaM+L4xMczy0IfEn18h/ojC8OJxWiH5NgR9DQuF3EjLhkuQ==" crossorigin=anonymous defer></script><script src=https://localstack.cloud/main.min.c667076fdc4df64bfcdde045586335c6f39e83b2890638c198f84cf7b06629acef2ef8536a38a1c5978689f003b2bd3918bc5b3400e1e62670dd1a558e29ccd9.js integrity="sha512-xmcHb9xN9kv83eBFWGM1xvOeg7KJBjjBmPhM97BmKazvLvhTajihxZeGifADsr05GLxbNADh5iZw3RpVjinM2Q==" crossorigin=anonymous defer></script><script src=https://localstack.cloud/index.min.c2da4191ad0c3393cc0c7a8a4be30ffb6cbad3bfeb981cfc4bd329961f4cfe3617b044abf4a90e1f7a0465b2bc9a6cbb4908d67cc6ad8750b62e46c3d2896977.js integrity="sha512-wtpBka0MM5PMDHqKS+MP+2y607/rmBz8S9Mplh9M/jYXsESr9KkOH3oEZbK8mmy7SQjWfMath1C2LkbD0olpdw==" crossorigin=anonymous defer></script></body></html>